# qb-gascompany (QBCore)

سكريبت وظيفة مدنية متكامل لشركة الغاز في FiveM بنظام QBCore.

## المزايا
- نظام دوام كامل مع **رأس شاحنة + مقطورة غاز** لا تعمل إلا أثناء الدوام.
- مهام توصيل وتعبئة غاز للمنازل والمنشآت عبر NPC.
- نظام تفاعل مباشر عبر زر `E` بدون الحاجة إلى target.
- واجهة **NUI احترافية** لإدارة الدوام، الإحصائيات، والموظفين.
- صلاحيات مدير: متابعة الموظفين، عرض الحالة، **ترقية الموظف**، وطرد الموظف.
- نظام رواتب: راتب أساسي + بونص على عدد المهام + مكافآت milestones.
- إضافة مواقع جديدة في **Paleto** و **Sandy** مع أجر أعلى في Sandy.
- خصم تلقائي عند عدم إرجاع الشاحنة.
- Anti-Exploit أساسي (تحقق الوظيفة، تبريد طلب المهام، timeout).
- استخدام Props من اللعبة لإضفاء واقعية محطة التعبئة.

- نظام عقود للشركة (Contracts) بعقود مناطق Sandy/Paleto مع بونص مالي عند الإكمال.
- سمعة ديناميكية للشركة (Reputation) ترتفع مع الأداء السريع وتنخفض مع الأداء الضعيف/المخالفات.
- اقتصاد ديناميكي للأسعار (Dynamic Economy) حسب أوقات الذروة ومستوى المخزون.
- إدارة أسطول (Fleet Tier) وإدارة الشفتات من لوحة المدير.
- خصومات تشغيل دورية على الشركة (Operating Costs) وتنبيهات تشغيل دورية للموظفين.
- نظام تقدم الموظفين (XP/Level) داخل الوظيفة.

## البنية
```
qb-gascompany/
├─ fxmanifest.lua
├─ shared/config.lua
├─ client/
│  ├─ main.lua
│  ├─ target.lua
│  └─ nui.lua
├─ server/main.lua
└─ web/
   ├─ index.html
   ├─ style.css
   └─ app.js
```

## المتطلبات
- `qb-core`
- `ox_lib`
- `oxmysql`

## التثبيت
1. ضع مجلد `qb-gascompany` داخل `resources/[jobs]/`.
2. أضف `ensure qb-gascompany` في `server.cfg` بعد المتطلبات.
3. أضف وظيفة `gascompany` في `qb-core/shared/jobs.lua`.
4. عدّل `shared/config.lua` حسب سيرفرك (مواقع، رواتب، موديلات، إلخ).

## مثال وظيفة QBCore
```lua
['gascompany'] = {
    label = 'شركة الغاز',
    defaultDuty = false,
    offDutyPay = false,
    grades = {
        ['0'] = { name = 'متدرب', payment = 80 },
        ['1'] = { name = 'موظف', payment = 120 },
        ['2'] = { name = 'مشرف', payment = 160 },
        ['3'] = { name = 'نائب مدير', payment = 200 },
        ['4'] = { name = 'مدير', isboss = true, payment = 250 },
    }
}
```

## طريقة اللعب الجديدة
1. الموظف يبدأ الدوام.
2. يستلم رأس الشاحنة مع المقطورة.
3. يفتح اللوحة ويختار عدد المواقع (1 إلى 5) ثم يبدأ المسار.
4. يذهب للموقع الأول، يتحدث مع المدني.
5. يبدأ التعبئة مباشرة عند المدني بعد الحديث (بدون خطوة سحب nozzle).
6. عند بدء التعبئة تظهر شاشة سوداء مع واجهة تعبئة صغيرة (شريط تقدّم) حتى انتهاء تعبئة الطلب.
7. يرجع للمدني لاستلام الدفعة، ثم ينتقل تلقائياً للموقع التالي حتى يخلص كل المواقع المختارة.

## التحكم (بدون Target)
- عند نقطة الشركة: `E` لبدء/إنهاء الدوام.
- عند نقطة الشركة: `Shift + E` لفتح لوحة الإدارة.
- عند موقف الشاحنة: `E` لاستلام الشاحنة + المقطورة.
- عند نقطة المهام: `E` لفتح/طلب مسار مهام.
- عند نقطة الإرجاع: `E` لإرجاع الشاحنة.
- قرب المدني في المهمة: `E` للتفاعل.
- قرب المدني بعد الحديث: `E` لبدء التعبئة مع واجهة تعبئة سوداء.

## ملاحظات
- السكربت لا يحتوي أي أنظمة انفجار أو تسريب (حسب الطلب).
- يمكن ربطه لاحقاً مع أنظمة محاسبة/فاتورة أو هواتف RP بسهولة عبر أحداث السيرفر.
- الواجهة مبنية بطابع glassmorphism حديث مع أزرار كاملة الوظائف.
- في حال خطأ "لا يوجد مفتاح" تأكد أن مورد مفاتيح المركبات لديك يعمل (مثل `qb-vehiclekeys`).


## نظام الشركة المالي
- لكل مهمة يتم اقتطاع نسبة للشركة (`companyCutPercent`) وتدخل في رصيد الشركة.
- المدير يقدر يسحب من رصيد الشركة لحسابه البنكي.
- المدير يقدر يستورد غاز للشركة (زيادة مخزون الشركة) مقابل تكلفة من رصيد الشركة.

## واجهة خزان المقطورة
- عند ركوب رأس الشاحنة تظهر واجهة صغيرة على طرف الشاشة توضح مستوى لتر خزان المقطورة.
- إذا نفد الغاز لن تتمكن من التعبئة حتى ترجع لمقر الشركة وتعيد تعبئة الخزان.

## حل مشكلة تشغيل الشاحنة
- تم إضافة تسليم مفاتيح بعدة طرق متوافقة (`vehiclekeys` + `qb-vehiclekeys` + `AcquireVehicleKeys`) مع جعل المركبة مملوكة للاعب وإلغاء hotwire.
- عند استلام الشاحنة يتم إدخالك تلقائياً لمقعد السائق وتشغيل المحرك.

## حل تعليق واجهة اللوحة
- تمت إضافة إغلاق احتياطي من جهة العميل عند ضغط ESC/Backspace حتى لو تعطل JavaScript بالواجهة.
- فتح اللوحة الآن يثبت الفوكس والماوس (`SetNuiFocus` + `SetCursorLocation`) لتفادي حالة الشاشة المعلقة بدون مؤشر.

## إضافات إدارية متقدمة
- تعيين نوع الأسطول الحالي (Standard/Heavy).
- تعيين الشفت الفعال (Open/Morning/Evening).
- تفعيل/إيقاف العقود ومتابعة التقدم من لوحة المدير.
- عرض سمعة الشركة، التحليلات، الرصيد، المخزون، والاستيراد في لوحة واحدة.